import{r as F,aw as T,N as h,f as O,g as W,C as G}from"./index-61771442.js";import"./lodash-52c9deff.js";import{y as H,J as X,K as P}from"./priceReference-c8273968.js";var K=(e=>(e.all="all",e.transmuter="transmuter",e.borrow="borrow",e.AMO="AMO",e))(K||{}),J=(e=>(e.all="All events",e.mint="Mint",e.burn="Burn",e.lock="Lock ANGLE",e.stake="Deposit in savings",e.unstake="Withdraw from savings",e.rateupdate="Savings Rate Updated",e.borrow="Borrow",e.repay="Repay debt",e.deposit="Deposit collateral",e.withdraw="Withdraw collateral",e))(J||{}),q=(e=>(e.all="all",e.EURA="EURA",e.USDA="USDA",e))(q||{}),z=(e=>(e.EURA="stEUR",e.USDA="stUSD",e))(z||{});function Q(e){return e==="WETH"?e="wETH":e==="WBTC"?e="wBTC":e==="wstETH"?e="wSTETH":e==="miMATIC"?e="MAI":e==="WAVAX"?e="wAVAX":e==="WMATIC"?e="wMATIC":e==="agstk-sd-LUSD3CRV-f"?e="sd-crvLUSD3CRV":e==="agstk-cvx-LUSD3CRV-f"?e="cvx-crvLUSD3CRV":e==="agstk-cvx-3Crv"?e="cvx-3CRV":e==="agstk-sd-3Crv"?e="sd-3CRV":e==="agstk-sd-2CRV"?e="sd-crvUSDCUSDT":e==="agstk-cvx-2CRV"?e="cvx-crvUSDCUSDT":e==="agstk-crvFRAX"?e="sd-crvFRAXUSDC":e==="agstk-cvx-crvFRAX"&&(e="cvx-crvFRAXUSDC"),e}const Y=6;function ae(e,u,o,f){var V,M,x,C;let w="stEUR";o===q.USDA&&(w="stUSD");let m=0;const v={};let d=0;const l={};if(e.borrow.hasOwnProperty(o))for(const r of Object.keys(e.borrow[o]))for(const i of Object.keys(e.borrow[o][r])){const t=e.borrow[o][Number.parseInt(r)][i],L=Q(i);if(Number.parseFloat(t==null?void 0:t.borrowed)){m+=Number.parseFloat(t==null?void 0:t.debt)*f;const _=(V=F(Number.parseInt(r))[T(o)].borrowCollaterals[L])==null?void 0:V.VaultManager;v[`${r}_${L}`]={name:`${h[r]} - ${L}`,value:Number.parseFloat(t==null?void 0:t.debt)*f,etherscanLink:O(Number.parseInt(r),_,"address")},d+=Number.parseFloat(t==null?void 0:t.borrowed)*f,l[`${r}_${L}`]={name:`${h[r]} - ${L}`,value:Number.parseFloat(t==null?void 0:t.borrowed)*f,etherscanLink:O(Number.parseInt(r),_,"address")}}}let n=0;const k={};let s=0;const y={};if(e.amo.hasOwnProperty(o))for(const r of Object.keys(e.amo[o]))for(const i of Object.keys(e.amo[o][r])){const t=e.amo[o][Number.parseInt(r)][i];n+=Number.parseFloat(t==null?void 0:t.tvlAllAssets)??0,k[`${r}_${i}`]={name:`${h[r]} - ${t.name}`,value:Number.parseFloat(t==null?void 0:t.tvlAllAssets)??0,etherscanLink:O(Number.parseInt(r),F(Number.parseInt(r)).Guardian,"address")},s+=Number.parseFloat(t==null?void 0:t.issued)*f,y[`${r}_${i}`]={name:`${h[r]} - ${t.name}`,value:Number.parseFloat(t==null?void 0:t.issued)*f,etherscanLink:O(Number.parseInt(r),F(Number.parseInt(r)).Guardian,"address")}}let b=0;const N={};let p=0;const c={};if(e.transmuter.hasOwnProperty(o))for(const r of Object.keys(e.transmuter[o]))for(const i of Object.keys(e.transmuter[o][r])){const t=e.transmuter[o][Number.parseInt(r)][i];b+=Number.parseFloat(t==null?void 0:t.tvl)??0,N[`${r}_${i}`]={name:`${h[r]} - ${i}`,value:Number.parseFloat(t==null?void 0:t.tvl)??0,etherscanLink:O(Number.parseInt(r),t.address,"balance",(M=F(Number.parseInt(r)).EUR)==null?void 0:M.Transmuter)},p+=Number.parseFloat(t==null?void 0:t.issued)*f,c[`${r}_${i}`]={name:`${h[r]} - ${i}`,value:Number.parseFloat(t==null?void 0:t.issued)*f,etherscanLink:O(Number.parseInt(r),(x=F(Number.parseInt(r)).EUR)==null?void 0:x.Transmuter,"address")}}let a=0;const A={};if(e.treasury.hasOwnProperty(o))for(const r of Object.keys(e.treasury[o]))for(const i of Object.keys(e.treasury[o][r])){const t=e.treasury[o][Number.parseInt(r)][i];t.tvl&&(a+=Number.parseFloat(t==null?void 0:t.tvl)??0,A[`${r}_${i}`]={name:`${h[r]} - ${i}`,value:Number.parseFloat(t==null?void 0:t.tvl)??0,etherscanLink:`${O(Number.parseInt(r),t.address,"balance",F(Number.parseInt(r)).Guardian)} | ${O(Number.parseInt(r),t.address,"balance",F(Number.parseInt(r)).Governor)}`})}let R=0;const S={};if(u.hasOwnProperty(o))for(const r of Object.keys(u[o])){const i=u[o][Number.parseInt(r)];R+=Number.parseFloat(i==null?void 0:i.accrued)*f,S[`${r}`]={name:`${h[r]} - ${w}`,value:Number.parseFloat(i==null?void 0:i.accrued)*f,etherscanLink:O(Number.parseInt(r),(C=F(Number.parseInt(r)).EUR)==null?void 0:C.Savings,"address")}}const j={"borrow-asset":{name:"Borrow Module",type:"asset",value:m,breakdown:v},"borrow-liability":{name:"Borrow Module",type:"liability",value:d,breakdown:l},"amo-asset":{name:"AMOs",type:"asset",value:n,breakdown:k},"amo-liability":{name:"AMOs",type:"liability",value:s,breakdown:y},"transmuter-asset":{name:"Transmuter Module",type:"asset",value:b,breakdown:N},"transmuter-liability":{name:"Transmuter Module",type:"liability",value:p,breakdown:c},"treasury-asset":{name:"Treasury",type:"asset",value:a,breakdown:A},"savings-liability":{name:"Savings",type:"liability",value:R,breakdown:S}},U=Object.values(j).filter(r=>r.type==="asset").reduce((r,i)=>r+i.value,0),$=Object.values(j).filter(r=>r.type==="liability").reduce((r,i)=>r+i.value,0);j.equity={name:"Equity",type:U>$?"liability":"asset",value:Math.abs(U-$),breakdown:{}};let B=0,I=0,E=0,g=0;for(const r of Object.values(j))r.value/Math.max(U,$)<Y/100&&(r.type==="asset"?(B++,E+=r.value):(I++,g+=r.value));return{totalAssets:U,totalLiabilities:$,assetBelowMinBlock:B,liabilityBelowMinBlock:I,totalAssetOffset:E,totalLiabilityOffset:g,detail:j}}function Z(e,u,o,f){const w=f[e]?f[e]:1;let m=0,v=0;if(u.borrow.hasOwnProperty(e))for(const p of Object.keys(u.borrow[e]))for(const c of Object.keys(u.borrow[e][p])){const a=u.borrow[e][Number.parseInt(p)][c];Number.parseFloat(a==null?void 0:a.borrowed)&&(m+=Number.parseFloat(a==null?void 0:a.debt),v+=Number.parseFloat(a==null?void 0:a.borrowed))}let d=0,l=0;if(u.amo.hasOwnProperty(e))for(const p of Object.keys(u.amo[e]))for(const c of Object.keys(u.amo[e][p])){const a=u.amo[e][Number.parseInt(p)][c];d+=Number.parseFloat(a==null?void 0:a.tvlAllAssets)??0,l+=Number.parseFloat(a==null?void 0:a.issued)*w}let n=0,k=0;if(u.transmuter.hasOwnProperty(e))for(const p of Object.keys(u.transmuter[e]))for(const c of Object.keys(u.transmuter[e][p])){const a=u.transmuter[e][Number.parseInt(p)][c];n+=Number.parseFloat(a==null?void 0:a.tvl)??0,k+=Number.parseFloat(a==null?void 0:a.issued)*w}let s=0;if(u.treasury.hasOwnProperty(e))for(const p of Object.keys(u.treasury[e]))for(const c of Object.keys(u.treasury[e][p])){const a=u.treasury[e][Number.parseInt(p)][c];a.tvl&&(s+=Number.parseFloat(a==null?void 0:a.tvl)??0)}let y=0;if(o.hasOwnProperty(e))for(const p of Object.keys(o[e])){const c=o[e][Number.parseInt(p)];y+=Number.parseFloat(c==null?void 0:c.accrued)*w}const b=m+d+n+s-v-l-k-y,N=(100*b/(v+l+k+y)).toFixed(2);return{equity:b,equityLiabilityRatio:N}}function D(e,u,o,f,w){let m=0;for(const[v,d]of Object.entries(e))if(!(f&&f!=="all"&&v!==f.toLowerCase())){for(const[l,n]of Object.entries(d))if(!(o&&o!=="all"&&o!==l)){for(const[k,s]of Object.entries(n))if(!(w&&w!==0&&Number.parseInt(k)!==w))for(const y of Object.values(s))v==="borrow"?m+=Number.parseFloat(y.borrowed)*u[l]*(Number.parseFloat(y.stabilityFee)-1):v==="amo"?y.name.split(" - ")[0]==="Lending"&&(m+=Number.parseFloat(y.current)*Number.parseFloat(y.apr)*u[l]):m+=Number.parseFloat(y.tvl)*Number.parseFloat(y.apr)}}return m}function ee(e,u,o,f){const w={EURA:.1,USDA:.4},m=w[f]?w[f]:.1;return Math.min(.9*(e/u)/o,m)}function oe(e,u,o,f,w,m,v,d,l){var k;const n={};m||(m=0),v||(v="all"),e.EURA||(e.EURA=e.EUR?e.EUR:1),e.USDA||(e.USDA=1);for(const[s,y]of Object.entries(u))if(!(s!==v.toLowerCase()&&v!=="all"))for(const[b,N]of Object.entries(y)){if(!n.hasOwnProperty(b)&&N){let p={equity:0,equityLiabilityRatio:"0"},c=0;try{p=Z(b,u,w,e),c=D(u,e,b,v,m)}catch{continue}let a=0;d&&d.hasOwnProperty(b)&&(a=d[b]),n[b]={tvl:0,supply:0,holders:0,equity:p,revenue:c,volume:0,volume24h:a,apy:0,staked:0,price:e[b]?e[b]:1,inducedTVL:0}}for(const[p,c]of Object.entries(N))if(!(Number.parseInt(p)!==m&&m!==0))for(const[a,A]of Object.entries(c)){if(s==="treasury"&&(a==="EURA"||a==="USDA"))continue;const R=[H,X,P];s==="amo"&&A.amoAddress&&R.includes(W(A.amoAddress)??"")&&(n[b].inducedTVL+=A.tvl-(A.current-A.issued)),Number.parseFloat(A.tvl)>0&&(n[b].tvl+=Number.parseFloat(A.tvl))}}for(const[s,y]of Object.entries(w))for(const[b,N]of Object.entries(y))n.hasOwnProperty(s)||(n[s]={staked:0}),b==="1"&&(n[s].apy=Number.parseFloat(N.apr)),!(Number.parseInt(b)!==m&&m!==0)&&(n[s].staked+=Number.parseFloat(N.totalAssets));for(const[s,y]of Object.entries(o))for(const[b,N]of Object.entries(y))Number.parseInt(b)!==m&&m!==0||(n[s].supply+=Number.parseFloat(N));for(const[s,y]of Object.entries(f))for(const[b,N]of Object.entries(y))Number.parseInt(b)!==m&&m!==0||(n[s].holders+=Number.parseInt(N.holders),n[s].volume+=Number.parseFloat(N.volume)*(e[s]?e[s]:1));for(const s of Object.keys(n))n[s].computedApr=ee(n[s].revenue,e[s]?e[s]:1,n[s].staked,s),n[s].savingsCost=n[s].apy*n[s].staked*(e[s]?e[s]:1),n[s].address=(k=F(G.MAINNET)[T(s)])==null?void 0:k.AgToken,n[s].symbol=s;return l?Object.values(n):Object.values(n).filter(s=>s.symbol!=="protocol")}export{J as A,K as M,q as S,ae as a,z as b,Q as c,oe as g};
